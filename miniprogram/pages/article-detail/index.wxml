<view class="container">
  <!-- 字幕滚动区域 -->
  <scroll-view 
    class="subtitle-container" 
    scroll-y 
    scroll-into-view="{{currentSubtitleId}}"
    scroll-into-view-offset="{{scrollOffset}}"
    scroll-with-animation="{{true}}"
  >
    <view class="subtitle-list">
      <!-- 字幕内容 -->
      <view 
        wx:for="{{subtitles}}" 
        wx:key="index"
        id="subtitle-{{index}}"
        class="subtitle-item {{currentIndex === index ? 'active' : ''}}"
      >
        <!-- 时间标记（左侧，可点击跳转） -->
        <view class="time-marker" bindtap="onTimeClick" data-time="{{item.time}}" data-index="{{index}}">
          {{item.timeText}}
        </view>
        
        <!-- 字幕内容区域（右侧） -->
        <view class="subtitle-content">
          <view class="subtitle-english" wx:if="{{subtitleMode === 'en' || subtitleMode === 'both'}}">
            <text 
              wx:for="{{item.englishWords}}" 
              wx:key="index"
              class="{{item.isWord ? 'word-clickable' : 'punctuation'}}"
              bindtap="{{item.isWord ? 'onWordClick' : ''}}"
              data-word="{{item.text}}"
            >{{item.text}}</text>
          </view>
          <view class="subtitle-chinese" wx:if="{{subtitleMode === 'zh' || subtitleMode === 'both'}}">{{item.chinese}}</view>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- 底部控制栏 -->
  <view class="control-bar">
    <!-- 第一行：功能按钮 -->
    <view class="top-controls">
      <!-- 单词 -->
      <view class="top-control-btn" bindtap="onDict">
        <image class="top-control-icon" src="/resource/icons/book.svg" mode="aspectFit"></image>
      </view>
      
      <!-- 重复播放 -->
      <view class="top-control-btn {{isLooping ? 'active' : ''}}" bindtap="onRepeat">
        <image class="top-control-icon" src="/resource/icons/repeat.svg" mode="aspectFit"></image>
      </view>
      
      <!-- 字幕设置 -->
      <view class="top-control-btn" bindtap="onSubtitleSettings">
        <image class="top-control-icon" src="/resource/icons/language.svg" mode="aspectFit"></image>
      </view>
      
      <!-- 倍速设置 -->
      <view class="top-control-btn" bindtap="onSpeedChange">
        <image class="top-control-icon" src="/resource/icons/gauge.svg" mode="aspectFit"></image>
      </view>
    </view>
    
    <!-- 第二行：进度条 -->
    <view class="progress-container">
      <slider 
        class="progress-slider"
        min="0"
        max="{{duration}}"
        value="{{currentTime}}"
        activeColor="rgb(52, 152, 219)"
        backgroundColor="#e0e0e0"
        block-size="12"
        bindchange="onProgressChange"
        bindchanging="onProgressChanging"
      />
    </view>
    
    <!-- 第三行：播放控制 -->
    <view class="controls">
      <!-- 上一句 -->
      <view class="control-btn" bindtap="onPrevious">
        <image class="control-icon" src="/resource/icons/backward.svg" mode="aspectFit"></image>
      </view>
      
      <!-- 播放/暂停 -->
      <view class="control-btn play-btn" bindtap="onPlayPause">
        <image 
          class="control-icon" 
          src="{{isPlaying ? '/resource/icons/pause.svg' : '/resource/icons/play.svg'}}" 
          mode="aspectFit"
        ></image>
      </view>
      
      <!-- 下一句 -->
      <view class="control-btn" bindtap="onNext">
        <image class="control-icon" src="/resource/icons/forward.svg" mode="aspectFit"></image>
      </view>
    </view>
  </view>


  <!-- 单词卡片弹出层 -->
  <view class="vocabulary-overlay {{showVocabulary ? 'show' : ''}}" bindtap="onCloseVocabulary">
    <view 
      class="vocabulary-card {{showVocabulary ? 'slide-up' : ''}}" 
      catchtap="stopPropagation"
      bindtouchstart="onCardTouchStart"
      bindtouchmove="onCardTouchMove"
      bindtouchend="onCardTouchEnd"
    >
      <!-- 简单的拖拽把手 -->
      <view class="drag-handle"></view>
      
      <!-- 重点单词列表 -->
      <view class="vocabulary-title">重点单词</view>
      <scroll-view 
        class="vocabulary-content" 
        scroll-y="{{true}}" 
        bindscrolltolower="onScrollToLower">
        
        <!-- 使用word-list组件 -->
        <word-list 
          words="{{vocabularyWords}}"
          mode="readonly"
          showFavoriteBtn="{{true}}"
          showNumber="{{true}}"
          customClass="article-word-list"
          bind:wordtap="onWordTap"
          bind:favoriteToggle="onToggleFavorite"
        ></word-list>
        
        <!-- 加载状态提示 -->
        <view wx:if="{{loadingMore}}" class="loading-more">加载中...</view>
        <view wx:elif="{{!hasMoreWords && vocabularyWords.length > 0}}" class="no-more">没有更多了</view>
      </scroll-view>
    </view>
  </view>

  <!-- 单词详情弹窗 -->
  <view class="word-detail-overlay {{showWordDetail ? 'show' : ''}}" bindtap="onCloseWordDetail">
    <view 
      class="word-detail-modal {{showWordDetail ? 'slide-up' : ''}}" 
      catchtap="stopPropagation"
    >
      <!-- 弹窗头部 -->
      <!-- 单词信息内容 -->
      <view class="word-detail-content">
        <!-- 单词主要信息 -->
        <view class="word-main-info">
          <view class="word-title">{{currentWord.word}}</view>
          <view class="word-phonetic-info" wx:if="{{currentWord.phonetic_uk || currentWord.phonetic_us}}">
            <!-- 英式音标 -->
            <view wx:if="{{currentWord.phonetic_uk}}" class="phonetic-item" bindtap="onPlayAudio" data-type="uk">
              <image class="speaker-icon" src="/resource/icons/volume.svg" mode="aspectFit"></image>
              <text class="phonetic-label">英</text>
              <text class="phonetic-text">/{{currentWord.phonetic_uk}}/</text>
            </view>
            
            <!-- 美式音标 -->
            <view wx:if="{{currentWord.phonetic_us}}" class="phonetic-item" bindtap="onPlayAudio" data-type="us">
              <image class="speaker-icon" src="/resource/icons/volume.svg" mode="aspectFit"></image>
              <text class="phonetic-label">美</text>
              <text class="phonetic-text">/{{currentWord.phonetic_us}}/</text>
            </view>
          </view>
        </view>
        
        <!-- 释义列表 -->
        <view class="translations-section">
          <view class="section-title">释义</view>
          <view class="translations-list">
            <view wx:for="{{currentWord.translation}}" wx:key="index" class="translation-item-detail">
              <view wx:if="{{item.type}}" class="pos-tag">{{item.type}}</view>
              <view class="translation-content">
                <view class="meaning-text">{{item.meaning}}</view>
              </view>
            </view>
          </view>
        </view>
        
        <!-- 标签信息 -->
        <view class="tags-section" wx:if="{{currentWord.translatedTags && currentWord.translatedTags.length}}">
          <view class="section-title">标签</view>
          <view class="tags-list">
            <text wx:for="{{currentWord.translatedTags}}" wx:key="*this" class="tag-item">{{item}}</text>
          </view>
        </view>
      </view>
      
      <!-- 底部操作按钮 -->
      <view class="word-detail-actions">
        <view class="action-btn secondary" bindtap="onCloseWordDetail">
          关闭
        </view>
        <view class="action-btn primary {{currentWord.isCollected ? 'collected' : ''}}" bindtap="onToggleWordCollection">
          {{currentWord.isCollected ? '已收藏' : '加入单词本'}}
        </view>
      </view>
    </view>
  </view>
</view> 