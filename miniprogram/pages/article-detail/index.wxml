<view class="container">
  <!-- 字幕滚动区域 -->
  <scroll-view 
    class="subtitle-container" 
    scroll-y 
    scroll-into-view="{{currentSubtitleId}}"
    scroll-into-view-offset="{{scrollOffset}}"
    scroll-with-animation="{{true}}"
  >
    <view class="subtitle-list">
      <!-- 字幕内容 -->
      <view 
        wx:for="{{subtitles}}" 
        wx:key="index"
        id="subtitle-{{index}}"
        class="subtitle-item {{currentIndex === index ? 'active' : ''}}"
        data-index="{{index}}"
        bindtap="onSubtitleTap"
      >
        <view class="subtitle-time" style="display: none;">{{item.timeText}}</view>
        <view class="subtitle-english">{{item.english}}</view>
        <view class="subtitle-chinese" wx:if="{{showChinese}}">{{item.chinese}}</view>
      </view>
    </view>
  </scroll-view>

  <!-- 底部控制栏 -->
  <view class="control-bar">
    <!-- 第一行：功能按钮 -->
    <view class="top-controls">
      <!-- 单词 -->
      <view class="top-control-btn" bindtap="onDict">
        <image class="top-control-icon" src="/resource/icons/book.svg" mode="aspectFit"></image>
      </view>
      
      <!-- 重复播放 -->
      <view class="top-control-btn {{isLooping ? 'active' : ''}}" bindtap="onRepeat">
        <image class="top-control-icon" src="/resource/icons/repeat.svg" mode="aspectFit"></image>
      </view>
      
      <!-- 字幕设置 -->
      <view class="top-control-btn" bindtap="onSubtitleSettings">
        <image class="top-control-icon" src="/resource/icons/language.svg" mode="aspectFit"></image>
      </view>
      
      <!-- 倍速设置 -->
      <view class="top-control-btn" bindtap="onSettings">
        <image class="top-control-icon" src="/resource/icons/gauge.svg" mode="aspectFit"></image>
      </view>
    </view>
    
    <!-- 第二行：进度条 -->
    <view class="progress-container">
      <slider 
        class="progress-slider"
        min="0"
        max="{{duration}}"
        value="{{currentTime}}"
        activeColor="rgb(52, 152, 219)"
        backgroundColor="#e0e0e0"
        block-size="12"
        bindchange="onProgressChange"
        bindchanging="onProgressChanging"
      />
    </view>
    
    <!-- 第三行：播放控制 -->
    <view class="controls">
      <!-- 上一句 -->
      <view class="control-btn" bindtap="onPrevious">
        <image class="control-icon" src="/resource/icons/backward.svg" mode="aspectFit"></image>
      </view>
      
      <!-- 播放/暂停 -->
      <view class="control-btn play-btn" bindtap="onPlayPause">
        <image 
          class="control-icon" 
          src="{{isPlaying ? '/resource/icons/pause.svg' : '/resource/icons/play.svg'}}" 
          mode="aspectFit"
        ></image>
      </view>
      
      <!-- 下一句 -->
      <view class="control-btn" bindtap="onNext">
        <image class="control-icon" src="/resource/icons/forward.svg" mode="aspectFit"></image>
      </view>
    </view>
  </view>

  <!-- 设置弹窗 -->
  <view class="modal-overlay {{showSettings ? 'show' : ''}}" bindtap="onCloseSettings">
    <view class="settings-modal" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">播放设置</text>
        <view class="close-btn" bindtap="onCloseSettings">
          <image class="close-icon" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE5IDYuNDE4MjZMMTcuNTgxNyA1TDEyIDEwLjU4MTdMNi40MTgzNiA1TDUgNi40MTgyNkwxMC41ODE3IDEyTDUgMTcuNTgxN0w2LjQxODM2IDE5TDEyIDEzLjQxODNMMTcuNTgxNyAxOUwxOSAxNy41ODE3TDEzLjQxODMgMTJMMTkgNi40MTgyNloiIGZpbGw9IiM5OTkiLz4KPC9zdmc+Cg==" mode="aspectFit"></image>
        </view>
      </view>
      
      <view class="modal-content">
        <!-- 播放速度 -->
        <view class="setting-item">
          <text class="setting-label">播放速度</text>
          <view class="speed-options">
            <view 
              wx:for="{{speedOptions}}" 
              wx:key="*this"
              class="speed-btn {{playSpeed === item ? 'active' : ''}}"
              data-speed="{{item}}"
              bindtap="onSpeedChange"
            >
              {{item}}x
            </view>
          </view>
        </view>
        
        <!-- 字幕显示 -->
        <view class="setting-item">
          <text class="setting-label">字幕显示</text>
          <view class="subtitle-options">
            <view 
              class="subtitle-btn {{showChinese ? '' : 'active'}}"
              bindtap="onSubtitleModeChange"
              data-mode="en"
            >
              仅英语
            </view>
            <view 
              class="subtitle-btn {{showChinese ? 'active' : ''}}"
              bindtap="onSubtitleModeChange"
              data-mode="both"
            >
              双语
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 单词卡片弹出层 -->
  <view class="vocabulary-overlay {{showVocabulary ? 'show' : ''}}" bindtap="onCloseVocabulary">
    <view 
      class="vocabulary-card {{showVocabulary ? 'slide-up' : ''}}" 
      catchtap="stopPropagation"
      bindtouchstart="onCardTouchStart"
      bindtouchmove="onCardTouchMove"
      bindtouchend="onCardTouchEnd"
    >
      <!-- 卡片头部 -->
      <view class="card-header">
        <view class="drag-handle"></view>
        <view class="card-title-bar">
          <text class="card-title">{{vocabularyTitle || '单词本'}}</text>
          <view class="card-close-btn" bindtap="onCloseVocabulary">
            <image class="close-icon" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE5IDYuNDE4MjZMMTcuNTgxNyA1TDEyIDEwLjU4MTdMNi40MTgzNiA1TDUgNi40MTgyNkwxMC41ODE3IDEyTDUgMTcuNTgxN0w2LjQxODM2IDE5TDEyIDEzLjQxODNMMTcuNTgxNyAxOUwxOSAxNy41ODE3TDEzLjQxODMgMTJMMTkgNi40MTgyNloiIGZpbGw9IiM5OTkiLz4KPC9zdmc+Cg==" mode="aspectFit"></image>
          </view>
        </view>
      </view>
      
      <!-- 单词列表 -->
      <scroll-view class="vocabulary-content" scroll-y="{{true}}">
        <view class="word-list">
          <view 
            wx:for="{{vocabularyWords}}" 
            wx:key="id"
            class="word-item"
            data-word="{{item}}"
          >
            <!-- 序号容器 -->
            <view class="word-number-container">
              <view class="word-number">{{index + 1}}</view>
            </view>
            
            <!-- 内容区域 -->  
            <view class="word-content">
              <!-- 单词信息 -->
              <view class="word-main" bindtap="onWordTap" data-word="{{item}}">
                <view class="word-text">{{item.word}}</view>
                <view class="word-phonetic">{{item.phonetic}}</view>
              </view>
              
              <!-- 翻译区域 -->
              <view class="word-translation" bindtap="onWordTap" data-word="{{item}}">
                <view wx:for="{{item.translations}}" wx:key="*this" class="translation-item">
                  <text class="part-of-speech">{{item.partOfSpeech}}</text>
                  <text class="meaning">{{item.meaning}}</text>
                </view>
              </view>
              
              <!-- 右侧：收藏按钮 -->
              <view class="word-actions" catchtap="onToggleFavorite" data-id="{{item.id}}">
                <view class="favorite-btn {{item.isFavorited ? 'favorited' : ''}}">
                  <image class="favorite-icon" src="{{item.isFavorited ? '/resource/icons/star-fill.png' : '/resource/icons/star.png'}}" mode="aspectFit"></image>
                </view>
              </view>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
</view> 